Scratch文件表示数据结构
=======================
结构是这样：  
 - `tnode` - 数据位置(一定是数字)，也就是子节点所在tdata的开始位置。
 - `tdata` - 数据数值(可能是数字，文字)，当它是数字时它就是它表示的树根在tnode的位置。

树中节点有两种：  
 - 有子节点，无数据的星号(-\*)节点，
 - 无子节点，有数据的引号(-"xxx")节点，
 - 无子节点，无数据的X号(-X)节点，

```
-* (1)
 |-"角色1"  ------------------------ [1]
 |-* (2)  -------------------------- [2]
 | |-"造型1"  ---------------------- [4]
 | |-"造型2"  ---------------------- [5]
 | \-"造型3"  ---------------------- [6]
 \-* (3)  -------------------------- [3]
   \-* (4)  ------------------------ [7]
     |-"event_whenflagclicked" ----- [8]
     |-* (5)  ---------------------- [9]
     | |-"motion_gotoxy"  ---------- [11]
     | |-* (6)  -------------------- [10]
     | | |-"[文本]"  --------------- [14]
     | | \-"10"  ------------------- [15]
     | \-X  ------------------------ [13]
     \-* (7)  ---------------------- [12]
       |-"control_stop"  ----------- [16]
       \-X  ------------------------ [17]
```
那么，结构就会是这样：(数字旁边的括号只是为了方便理解)
```
	编号	tnode	编号	tdata
	(1)	[1]	[1]	"角色1"
			[2]	(2)
			[3]	(3)
	(2)	[4]	[4]	"造型1"
			[5]	"造型2"
			[6]	"造型3"
	(3)	[7]	[7]	(4)
	(4)	[8]	[8]	"event_whenflagclicked"
			[9]	(5)
			[10]	(6)
	(5)	[11]	[11]	"motion_gotoxy"
			[12]	(7)
			[13]	X(-1)
	(6)	[14]	[14]	"[文本]"
			[15]	"10"
	(7)	[16]	[16]	"control_stop"
			[17]	X(-1)
```
这意味着(1)号节点后面有[1]\[2][3]三个数据，分别是"角色1"，节点(2)和节点(3)，  
而节点2后面有[4]\[5][6]三个数据，节点(3)后面有[7]一个数据。

可以看到每个节点的数据的数量是由当前节点的tnode值和下一节点的tnode值决定，换句话说，  
节点(x)的数据是从`tnode(x)`开始，到`tnode(x+1)-1`结束的。(最后一个节点例外)

__当然，开始的节点不一定是(1)，事实上开始的节点编号可能会是一个很大的数字。__

不过你也许会问，实际应用的时候tdata列表里没有括号或者双引号，  
那么我怎么判断tdata里的 2 到底是 (2) 还是 "2" 呢？  
不用担心，树具有一定的规律，可以通过规律判断出数据的类型。

文件的树的样子
==============
文件的树长这样：

```
-* (作品)
 |-* (角色)
 | |-"角色1" (名字)
 | |-* (造型列表)
 | | |-"造型1"
 | | |-"造型2"
 | | \-"造型3"
 | |-* (声音列表)
 | | |-"声音1"
 | | |-"声音2"
 | | \-"声音3"
 | |-* (广播列表)
 | | |-"广播1"
 | | |-"广播2"
 | | \-"广播3"
 | |-* (变量列表)
 | | |-"变量1"
 | | |-"变量2"
 | | \-"变量3"
 | |-* (列表列表)
 | | |-"列表1"
 | | |-"列表2"
 | | \-"列表3"
 | |-* (定义列表)
 | | |-"定义1"
 | | |-"定义2"
 | | \-"定义3"
 | \-* (积木列表)
 |   |-* (开头积木1)
 |   | |-"event_whenflagclicked" (积木名称，当绿旗被点击)
 |   | \-* (下一个积木)
 |   |   |-"motion_gotoxy" (积木名称，移到 x： ( )， y： ( ))
 |   |   |-* (参数1)
 |   |   | |-"[文本]" (文本)
 |   |   | \-"10"
 |   |   |-* (参数2)
 |   |   | |-"operator_add" (积木名称，( )+( ))
 |   |   | |-* (参数1)
 |   |   | | |-"[文本]" (文本)
 |   |   | | \-"10"
 |   |   | |-* (参数2)
 |   |   | | |-"motion_yposition" (积木名称，(y坐标))
 |   |   | | \-X (下一个积木)
 |   |   | \-X (下一个积木)
 |   |   \-X (下一个积木)
 |   \-* (开头积木2)
 |     |- ... (省略)
 |     .
 |     .
 |     \-(省略)
 \-* (角色2)
   |- ... (省略)
   .
   .
   \-(省略)
```

感觉看起来很乱？下面仔细说明

作品节点
--------

作品由多个角色构成，像这样：

```
-* (作品)
 |-* (角色1)
 |-* (角色2)
 |-* (角色3)
 .
 .
 .
 \-* (角色N)
```

角色节点
--------

角色由名称，造型，声音，变量，列表，定义积木，积木构成。

```
-* (角色)
 |-"角色1" (名字)
 |-* (造型列表)
 |-* (声音列表)
 |-* (变量列表)
 |-* (列表列表)
 |-* (定义列表)
 \-* (积木列表)
```

造型节点(声音，变量，列表，定义同理)
--------

造型节点就是造型名字的列表

```
-* (造型)
 |-"造型1"
 |-"造型2"
 |-"造型3"
 .
 .
 .
 \-"造型N"
```
其他节点同理。  
注意：在造型，声音节点中，奇数项是名称，偶数项是文件名。  
注意：在定义节点中，奇数项是名称，偶数项是位置。

积木列表
--------

积木列表中的每一项表示一组积木。

```
-* (积木列表)
 |-* (积木节点1)
 |-* (积木节点2)
 |-* (积木节点3)
 .
 .
 .
 \-* (积木节点N)
```

积木节点
--------

积木节点有三种

1. 空节点

```
-X
```
表示没有积木拼接，或者没有下一个积木。

2. 积木节点

```
-* (积木节点)
 |-"motion_gotoxy" (积木类型)
 |-* (下一个积木的位置)
 |-* (参数1)
 |-* (参数2)
 .
 .
 .
 \-* (参数N)
```

3. 文字节点

```
-* (文字节点)
 |-"[文本]" (文字类型)
 \-"123123" (文字)
```

其中，文字类型有：

| 类型名     | 解释                             |
| ---------- | -------------------------------- |
| [文本]     | 表示一个文本(可能是选项或者输入) |
| [变量]     | 表示一个变量                     |
| [列表]     | 表示一个列表                     |
| [选项]     | 表示一个下拉选项                 |
| [参数]     | 表示一个自定义积木参数           |
| [布尔参数] | 表示一个自定义积木六边形参数     |

特殊的积木节点
--------------

1. 自定义积木定义 `procedures_definition`

```
-* (积木节点)
 |-"procedures_definition" (积木类型)
 |-"积木2 %s %s %s" (积木标签) [1]
 |-* (定义的积木)
 |-* (变量1)
 |-* (变量2)
 |-* (变量3)
 .
 .
 .
 \-* (变量N)

[1]： 如果积木开启了运行时不刷新屏幕，那么最后面会多一个"%"号
```

2. 自定义积木使用

```
-* (积木节点)
 |-"procedures_call" (积木类型)
 |-"积木2 %s %s %s" (积木标签) [1]
 |-* (下一个积木)
 |-* (变量1)
 |-* (变量2)
 |-* (变量3)
 .
 .
 .
 \-* (变量N)

[1]： 同样，如果积木开启了运行时不刷新屏幕，那么最后面会多一个“%”号
```
